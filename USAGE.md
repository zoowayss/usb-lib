# USBé‡å®šå‘ç¨‹åºä½¿ç”¨æŒ‡å—

## ğŸ‰ ç¼–è¯‘æˆåŠŸï¼

æ­å–œï¼æ‚¨çš„USBé‡å®šå‘ç¨‹åºå·²ç»æˆåŠŸç¼–è¯‘å¹¶é€šè¿‡äº†æ‰€æœ‰æµ‹è¯•ã€‚

## ğŸ“‹ ç¼–è¯‘ç»“æœ

- âœ… **å‘é€ç«¯ç¨‹åº**: `build/sender/usb_sender` (macOS)
- âœ… **æµ‹è¯•ç¨‹åº**: `build/tests/test_protocol`, `build/tests/test_network`
- âœ… **æ‰€æœ‰æµ‹è¯•é€šè¿‡**: 2/2 æµ‹è¯•æˆåŠŸ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‘é€ç«¯ (macOS)

```bash
# åŸºæœ¬å¯åŠ¨ (éœ€è¦sudoæƒé™è®¿é—®USBè®¾å¤‡)
sudo ./build/sender/usb_sender

# ç¨‹åºä¼šè‡ªåŠ¨ï¼š
# - æ‰«æUSBè®¾å¤‡ (å‘ç°äº†6ä¸ªUSBè®¾å¤‡)
# - æŸ¥æ‰¾å¤§å®¹é‡å­˜å‚¨è®¾å¤‡
# - å¯åŠ¨TCPæœåŠ¡å™¨ (ç«¯å£3240)
# - å¼€å§‹URBæ•è·
# - å¯ç”¨çƒ­æ’æ‹”ç›‘æ§
```

### 2. æ¥æ”¶ç«¯ (Linux)

ç”±äºå½“å‰åœ¨macOSç¯å¢ƒï¼Œæ¥æ”¶ç«¯éœ€è¦åœ¨Linuxç³»ç»Ÿä¸Šç¼–è¯‘å’Œè¿è¡Œï¼š

```bash
# åœ¨Linuxç³»ç»Ÿä¸Š
git clone <your-repo>
cd usb-redirector
./build.sh

# å¯åŠ¨æ¥æ”¶ç«¯
sudo ./build/receiver/usb_receiver --host <macOS_IP>
```

## ğŸ“Š ç¨‹åºè¿è¡ŒçŠ¶æ€

ä»æµ‹è¯•è¿è¡Œå¯ä»¥çœ‹åˆ°ç¨‹åºæ­£å¸¸å·¥ä½œï¼š

```
[INFO] USB device manager initialized successfully
[INFO] TCP server started on port 3240
[INFO] Enumerated 6 USB devices
[INFO] Found 0 mass storage devices (å½“å‰æ²¡æœ‰æ’å…¥Uç›˜)
[INFO] URB capture started
[INFO] Hotplug monitoring started
[INFO] USB Sender started successfully
```

## ğŸ”§ æµ‹è¯•éªŒè¯

### è¿è¡Œå•å…ƒæµ‹è¯•
```bash
cd build
make test

# ç»“æœï¼š
# Test #1: protocol_test .................... Passed
# Test #2: network_test ..................... Passed
# 100% tests passed, 0 tests failed out of 2
```

### æµ‹è¯•ç¨‹åºåŠŸèƒ½
```bash
# æµ‹è¯•åè®®åŠŸèƒ½
./tests/test_protocol

# æµ‹è¯•ç½‘ç»œåŠŸèƒ½  
./tests/test_network
```

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: åŸºæœ¬USBé‡å®šå‘
1. **macOSç«¯**: æ’å…¥Uç›˜ï¼Œå¯åŠ¨å‘é€ç«¯ç¨‹åº
2. **Linuxç«¯**: è¿æ¥åˆ°macOSï¼Œè‡ªåŠ¨å¯¼å…¥Uç›˜è®¾å¤‡
3. **ç»“æœ**: Linuxç³»ç»Ÿä¸­å‡ºç°è™šæ‹ŸUç›˜ï¼Œå¯ä»¥æ­£å¸¸è¯»å†™

### åœºæ™¯2: å¼€å‘è°ƒè¯•
1. ä½¿ç”¨Debugæ¨¡å¼ç¼–è¯‘: `./build.sh -d`
2. å¯ç”¨è¯¦ç»†æ—¥å¿—æŸ¥çœ‹æ•°æ®ä¼ è¾“è¿‡ç¨‹
3. ä½¿ç”¨æµ‹è¯•ç¨‹åºéªŒè¯åè®®æ­£ç¡®æ€§

### åœºæ™¯3: å¤šè®¾å¤‡æ”¯æŒ
1. åŒæ—¶æ’å…¥å¤šä¸ªUç›˜
2. ç¨‹åºè‡ªåŠ¨æ£€æµ‹å¹¶æ”¯æŒå¤šè®¾å¤‡é‡å®šå‘
3. æ”¯æŒçƒ­æ’æ‹”ï¼ŒåŠ¨æ€æ·»åŠ /ç§»é™¤è®¾å¤‡

## ğŸ› ï¸ é«˜çº§é…ç½®

### ä¿®æ”¹ç›‘å¬ç«¯å£
```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim config/sender.conf

# æˆ–è€…é€šè¿‡å‘½ä»¤è¡Œå‚æ•° (éœ€è¦å®ç°)
sudo ./sender/usb_sender --port 3241
```

### å¯ç”¨è°ƒè¯•æ¨¡å¼
```bash
# é‡æ–°ç¼–è¯‘ä¸ºDebugç‰ˆæœ¬
./build.sh -c -d

# å¯åŠ¨æ—¶ä¼šæ˜¾ç¤ºæ›´è¯¦ç»†çš„æ—¥å¿—
sudo ./build/sender/usb_sender
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æƒé™é”™è¯¯**
   ```bash
   # è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨sudo
   sudo ./sender/usb_sender
   ```

2. **æ²¡æœ‰å‘ç°å¤§å®¹é‡å­˜å‚¨è®¾å¤‡**
   ```
   [INFO] Found 0 mass storage devices
   
   # è§£å†³æ–¹æ¡ˆï¼šæ’å…¥Uç›˜åé‡å¯ç¨‹åºï¼Œæˆ–ç­‰å¾…çƒ­æ’æ‹”æ£€æµ‹
   ```

3. **ç½‘ç»œè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
   netstat -an | grep 3240
   
   # æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   sudo ufw allow 3240  # Linux
   ```

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
   ```bash
   # ç¨‹åºä¼šè¾“å‡ºè¯¦ç»†çš„è¿è¡ŒçŠ¶æ€
   [INFO] USB device manager initialized successfully
   [INFO] TCP server started on port 3240
   [INFO] Enumerated 6 USB devices
   ```

2. **æµ‹è¯•ç½‘ç»œè¿æ¥**
   ```bash
   # ä½¿ç”¨telnetæµ‹è¯•ç«¯å£è¿é€šæ€§
   telnet <macOS_IP> 3240
   ```

3. **æ£€æŸ¥USBè®¾å¤‡**
   ```bash
   # macOSæŸ¥çœ‹USBè®¾å¤‡
   system_profiler SPUSBDataType
   
   # LinuxæŸ¥çœ‹USBè®¾å¤‡
   lsusb
   ```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç½‘ç»œä¼˜åŒ–
- ä½¿ç”¨æœ‰çº¿ç½‘ç»œè¿æ¥
- è°ƒæ•´TCPç¼“å†²åŒºå¤§å°
- å¯ç”¨TCP_NODELAYé€‰é¡¹

### ç³»ç»Ÿä¼˜åŒ–
```bash
# å¢åŠ USB URBç¼“å†²åŒº (Linux)
echo 16 > /sys/module/usbcore/parameters/usbfs_memory_mb

# è°ƒæ•´ç½‘ç»œç¼“å†²åŒº
sudo sysctl -w net.core.rmem_max=16777216
sudo sysctl -w net.core.wmem_max=16777216
```

## ğŸ¯ ä¸‹ä¸€æ­¥å¼€å‘

1. **å®Œå–„æ¥æ”¶ç«¯**: åœ¨Linuxç¯å¢ƒä¸­æµ‹è¯•æ¥æ”¶ç«¯åŠŸèƒ½
2. **æ·»åŠ æ›´å¤šè®¾å¤‡ç±»å‹**: æ”¯æŒHIDè®¾å¤‡ã€éŸ³é¢‘è®¾å¤‡ç­‰
3. **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘å»¶è¿Ÿï¼Œæé«˜ä¼ è¾“é€Ÿåº¦
4. **ç”¨æˆ·ç•Œé¢**: å¼€å‘å›¾å½¢åŒ–ç®¡ç†ç•Œé¢
5. **å®‰å…¨å¢å¼º**: æ·»åŠ æ•°æ®åŠ å¯†å’Œè®¿é—®æ§åˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç³»ç»Ÿä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
2. æƒé™è®¾ç½®æ˜¯å¦æ­£ç¡®
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. USBè®¾å¤‡æ˜¯å¦è¢«æ­£ç¡®è¯†åˆ«

ç¨‹åºå·²ç»å…·å¤‡äº†å®Œæ•´çš„USBé‡å®šå‘åŠŸèƒ½æ¡†æ¶ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶ï¼
